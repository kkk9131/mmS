# Supabase Storage セットアップガイド

画像アップロード機能を使用するには、Supabaseプロジェクトでストレージバケットを作成する必要があります。

## セットアップ手順

### 1. Supabaseダッシュボードにログイン
[Supabase Dashboard](https://app.supabase.com) にアクセスしてプロジェクトを開きます。

### 2. SQL Editorでバケットを作成
1. 左側のメニューから「SQL Editor」を選択
2. 「New query」をクリック
3. `src/scripts/setup-storage-buckets.sql` の内容をコピー&ペースト
4. 「Run」ボタンをクリックして実行

### 3. 実行結果の確認
スクリプトの最後に確認用クエリが含まれています。以下の2つのバケットが作成されていることを確認してください：

- **posts**: 投稿画像用（最大10MB）
- **avatars**: プロフィール画像用（最大5MB）

### 4. Storage設定の確認（オプション）
1. 左側のメニューから「Storage」を選択
2. 「posts」と「avatars」バケットが表示されていることを確認
3. 各バケットが「Public」に設定されていることを確認

## トラブルシューティング

### エラー: "Bucket not found"
- SQL Editorでセットアップスクリプトを再実行してください
- Storageページでバケットが作成されているか確認してください

### エラー: "row-level security policy violation"
- RLSポリシーが正しく設定されていない可能性があります
- セットアップスクリプトを再実行してください
- ユーザーがログインしているか確認してください

### エラー: "Invalid JWT"
- 認証トークンが無効または期限切れです
- アプリからログアウトして、再度ログインしてください

## RLSポリシーについて

このセットアップでは以下のアクセス制御が設定されます：

### postsバケット
- **アップロード**: 認証済みユーザーのみ
- **閲覧**: 誰でも可能（公開）
- **更新/削除**: アップロードしたユーザーのみ

### avatarsバケット
- **アップロード**: 認証済みユーザーが自分のフォルダにのみ
- **閲覧**: 誰でも可能（公開）
- **更新/削除**: 所有者のみ

## 注意事項
- バケット作成はSupabaseダッシュボードから手動で行う必要があります
- RLSポリシーは自動的に適用されます
- 本番環境では、より厳密なアクセス制御を検討してください